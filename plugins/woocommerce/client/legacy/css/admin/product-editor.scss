/**
 * product-editor.scss
 * Styles for refubrished product and coupon editor.
 */

/**
 * Imports
 */
@import "@automattic/color-studio/dist/color-variables";

/**
 * Copy of some internal-style-build CSS variables
 */
$gap-large: 24px;
$gap: 16px;
$gap-small: 12px;
$gap-smaller: 8px;
$gap-smallest: 4px;

/**
 * Stylesheet specific variables.
 */
$alias-text: #070707;
$alias-text-tertiary: #505050;
$separator-color: #bbbcbf;
$border-radius: 8px;

/*
 * Match product & coupon editor page
 * This selector is increasing specificity a bit too much,
 * but we need to contain the style update to product and coupon editor only.
 */
.post-php.post-type-product,
.post-new-php.post-type-product,
.post-php.post-type-shop_coupon,
.post-new-php.post-type-shop_coupon {

	/* Style all buttons */
	.button,
	#screen-meta-links .show-settings {
		background: none;
		padding: 0 $gap-smaller;
		margin: 0;
		display: inline-flex;
		justify-content: center;
		align-items: center;
		line-height: inherit;
		gap: $gap-smallest;

		border-radius: 2px;
		border: 1px solid var(--wp-admin-theme-color, $studio-wordpress-blue);
		color: var(--wp-admin-theme-color, $studio-wordpress-blue);

		.jetpack-contact-form-icon,
		.wp-media-buttons-icon {
			height: 16px;
			width: 16px;
			font-size: 16px;
			margin: 0;

			&::before {
				font-size: inherit;
			}
		}
		&.button-primary {
			color: var(--Gutenberg-White, $studio-white);
			background: var(--wp-admin-theme-color, $studio-wordpress-blue);
		}
	}
	// Increase specificity to overwrite marketplace styles.
	.marketplace-suggestions-container.showing-suggestion .marketplace-suggestion-container {
		.marketplace-suggestion-container-cta a.button {
			display: inline-flex;
		}
	}

	// Screen meta links.
	#screen-meta-links {
		padding: $gap-small 0;
		display: flex;
		gap: $gap-smaller;

		.screen-meta-toggle,
		#screen-options-link-wrap,
		#contextual-help-link-wrap {
			margin: 0;
		}
		.show-settings {
			padding-left: $gap-small;
			// Deduct the inner spacing of the icon.
			padding-right: calc($gap-small - 5px);
		}

		/*
		 * Adjust spacing as the element is vertically aligned with flexbox,
		 * reset additional padding.
		 */
		.show-settings::after {
			padding: 0;
			position: static;
		}

	}

	// Gap between title input and generate coupon code.
	#titlewrap {
		display: flex;
		flex-direction: column;
		align-items: flex-start;
		gap: $gap-smallest;
	}

	// Title input.
	#titlediv {
		#title-prompt-text,
		#title {
			padding: $gap-smallest $gap;
			font-size: 20px;
			line-height: 46px;
			height: auto;
		}
		#title-prompt-text {
			color: var(--Gray-Gray-30, $studio-gray-30);
			// Offset by the same border as the input.
			border: 1px solid transparent;
		}
		#title {
			border-radius: $border-radius;
		}
	}

	/*
	 * Gap between Title and Slug edit should be 8px = $gap-smaller,
	 * so we need to clear margins.
	 */
	#poststuff #titlediv .inside {
		padding: 0;
		margin-top: $gap-smaller;
	}
	#edit-slug-box {
		padding: 0;
		margin: 0;
		color: $studio-black;
	}
	#titlediv #title {
		margin: 0;
	}

	// Postbox cards.
	.postbox {
		border: 0;
		border-radius: $border-radius;
		display: flex;
		flex-direction: column;
	}
	// Mimic wider gap between postboxes.
	.post-body-content,
	.postbox {
		margin-bottom: 28px;
	}
	#postdivrich {
		margin-top: 28px;
		.wp-editor-wrap {
			margin: $gap $gap 0;
		}
		#post-status-info {
			margin: 0 $gap $gap;
			width: calc(100% - 2 * $gap);
		}
	}

	// Post/meta boxes.
	.postbox-header {
		padding: 12px 12px 12px 16px;
		flex-shrink: 0;
		align-self: stretch;
		border-color: $separator-color;
		min-height: 30px;

		.hndle {
			gap: $gap-small;
			flex-wrap: wrap;
		}
	}
	.closed .postbox-header {
		border: 0;
	}

	.inside,
	#commentsdiv.postbox .inside,
	#postimagediv .inside {
		padding: 16px;

		/*
		 * Remove margins of paragraph wrappers that probably
		 * should have been divs separated with gap.
		 */
		p:first-child {
			margin-top: 0;
		}
		p:last-child {
			margin-bottom: 0;
		}
	}

	// Separate rule, not to overspecify the above ones with id selector.
	#poststuff {
		h2.postbox-header {
			padding: 12px 16px;
		}
		.hndle {
			padding: 0;
		}

		.inside {
			margin: 0;
		}
	}

	.wp-editor-tools {
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
	}

	// Rich editor tabs.
	.wp-editor-tabs {
		display: flex;
		align-self: flex-end;

		.wp-switch-editor {
			float: none;
			background: none;
			margin: 0;
			padding: 10px $gap;
			color: var(--Alias-text-text-tertiary, $alias-text-tertiary);
			border-width: 0 0 2px 0;
			border-bottom-color: transparent;
		}
	}
	.html-active .switch-html,
	.tmce-active .switch-tmce {
		border-bottom-color: var(--wp-admin-theme-color, $studio-wordpress-blue);
		color: var(--Alias-text-text, $alias-text);
	}


	.wp-media-buttons {
		display: flex;
		align-self: flex-start;
		flex-wrap: wrap;
		gap: $gap-small;
		padding-bottom: $gap;
	}
	.wp-editor-tools::after {
		content: none;
		display: none;
	}

	#postexcerpt > .postbox-header > .hndle > .woocommerce-help-tip,
	#wp-content-media-buttons > .woocommerce-help-tip {
		margin: 0;
	}

	// Product/coupon data options panel.
	.woocommerce_options_panel {
		.options_group:not(.hidden),
		/*
		 * General coupos data does not have options group wrapper,
		 * make it look like it has.
		 */
		&#general_coupon_data:not(.hidden) {
			display: flex;
		}
		.options_group,
		&#general_coupon_data {
			border-bottom: 1px solid #ededed;
			padding: 36px 48px;
			display: flex;
			flex-direction: column;
			gap: $gap-small;
		}

		/*
		 * Sold individually option has help tip icon as a direct child,
		 * not as a child of form-field paragraph.
		 * Let's make it look as it would be structured as others.
		 */
		.options_group.inventory_sold_individually {
			flex-direction: row;
			gap: 0;

			> ._sold_individually_field {
				margin: 0;
			}
		}
	}

	#commentsdiv .inside {
		display: flex;
		flex-direction: column;
		gap: $gap-smaller;

		p {
			padding: 0;
		}
	}

	// Custom Fields.
	#postcustomstuff {
		table {
			border-radius: 2px;
			background: none;
		}
		td {
			padding: 0;
		}
		td > input,
		select,
		textarea {
			margin: $gap-smaller;
			width: calc(100% - 2 * $gap-smaller);
		}
		thead th {
			padding: $gap-smaller;
			background: none;
			border-bottom: 1px solid #bbbcbf;
		}
	}

	// Publish metabox.
	#minor-publishing-actions {
		display: flex;
		justify-content: space-between;
		padding: 16px 16px 0 16px;

		.clear {
			display: none;
		}
	}

	#misc-publishing-actions {
		display: flex;
		flex-direction: column;
		gap: $gap-small;
		padding: 12px 16px 16px 16px;
	}
	// Hide all icons.
	#post-body {
		.misc-pub-post-status::before,
		#visibility::before,
		.curtime #timestamp::before,
		.misc-pub-uploadedby::before,
		.misc-pub-uploadedto::before,
		.misc-pub-revisions::before,
		.misc-pub-response-to::before,
		.misc-pub-comment-status::before {
			display: none;
		}
	}
	.misc-pub-section {
		padding: 0;
	}
	#major-publishing-actions {
		padding: $gap;
		border-top: 1px solid $separator-color;
		background: none;
	}

	// Categories metabox.
	#product_catdiv {
		.inside {
			padding: 0;
		}

	}
	.category-tabs {
		margin: 0;
		display: flex;
		border-bottom: 1px solid $separator-color;

		> li {
			border: 0;
			margin: 0 0 -1px;
			padding: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: $gap-smallest;
			background: none;
			border-bottom: 2px solid transparent;

			> a {
				color: var(--Alias-text-text-tertiary, $alias-text-tertiary);
				padding: 10px 16px;
				line-height: 1.5385;

				&:focus {
					box-shadow: 0 0 0 2px var(--wp-admin-theme-color, $studio-wordpress-blue);
				}
			}

			// Active state.
			&.tabs {
				border-color: var(--wp-admin-theme-color, $studio-wordpress-blue);
			}
		}

	}
	.categorydiv {
		margin-bottom: $gap;

		/*
		 * Cater for other elements injected to this meta box,
		 * like AI suggested categories.
		 */
		> :not(.category-tabs) {
			padding: 0 $gap;
			// Pretend all things below tab panel are in a box with gap.
			margin: $gap-small 0;
		}
		.tabs-panel {
			padding: $gap;
			margin: 0;
			border: 0;
			border-bottom: 1px solid $separator-color;

			ul {
				margin: 0;
			}
		}
		ul.categorychecklist ul {
			margin-left: 15px;

			@media screen and (max-width: 782px) {
				margin-top: 15px;
			}
		}
	}
	#product_cat-add-toggle {
		display: flex;
		justify-content: center;
		padding: $gap-smallest;
	}

	// Tags metabox.
	.tagsdiv {
		.jaxtag {
			display: flex;
			flex-direction: column;
			gap: $gap-smaller;
		}
		.ajaxtag {
			display: flex;
			flex-wrap: wrap;
			gap: $gap-smallest;
		}
		.the-tags {
			margin: 0;
			width: 100%;
		}
		.newtag {
			flex: 1;

			@media screen and (max-width: 782px) {
				margin-bottom: 0;
			}
		}
	}
	// For margins we need id specificity.
	#poststuff {
		.tagsdiv {
			.ajaxtag {
				margin: 0;
			}
			.howto {
				margin: 0;
			}
		}
		.the-tagcloud {
			margin-bottom: 0;
		}
	}

	// Product image.
	#postimagediv .inside {
		display: flex;
		flex-direction: column;
		gap: $gap-smaller;
		p {
			padding: 0;
		}
	}

	// Product gallery.
	#woocommerce-product-images .inside {
		padding: $gap;
		display: flex;
		flex-direction: column;
		gap: $gap-smaller;

		#product_images_container {
			padding: 0;
			margin: -$gap-smallest calc($gap-smallest * -2);
			ul li.image {
				margin: $gap-smallest;
			}
		}
		.add_product_images {
			padding: 0;
			margin: 0;
		}
	}
}

.post-php.post-type-product,
.post-new-php.post-type-product,
.post-php.post-type-shop_coupon,
.post-new-php.post-type-shop_coupon {
	// Duplicate the rule, for increased specificity
	.hidden,
	&.js .closed .inside,
	&.js .hide-if-js,
	&.js .wp-core-ui .hide-if-js,
	&.js.wp-core-ui .hide-if-js,
	&.no-js .hide-if-no-js,
	&.no-js .wp-core-ui .hide-if-no-js {
		display: none;
	}
}

/* Product/coupon data metabox */
#woocommerce-coupon-data,
#woocommerce-product-data {

	.hndle {
		span {
			line-height: 24px;
		}

		.product-data-wrapper {
			display: flex;
			align-items: center;
			gap: $gap;
			flex: 1;
			flex-wrap: wrap;

			.woocommerce-product-type-tip {
				font-size: 1.4em;
			}
		}

		select {
			margin: 0;
		}

		label {
			font-size: 12px;
			vertical-align: baseline;
			display: flex;
			flex-wrap: wrap;
			align-items: center;
			gap: $gap-smaller;
			margin-right: $gap;
		}

		label:first-child {
			padding-right: $gap;
			border-right: 1px solid #dfdfdf;
			gap: $gap-small;

			/*
			 * Make it look like product type select pertain
			 * to the same group as header and "—".
			 */
			margin-left: calc(-1 * ($gap - $gap-small));
			margin-right: 0;
		}

		input,
		select {
			margin-top: -2px;
			vertical-align: middle;
		}

		label.has-checkbox > input[type="checkbox"] {
			margin-right: 0;
		}
	}

	.inside {
		flex: 1;
		display: flex;
		min-height: 586px;
		margin: 0;
		padding: 0;
	}
	&.closed .inside {
		display: none;
	}

	.wrap {
		margin: 0;
	}

	.panel-wrap {
		flex: 1 0 0;
		align-self: stretch;
		display: grid;
		grid-template-columns: [nav] 20% [content] 80%;

		> * {
			grid-column: content;
			align-self: stretch;
			border-left: 1px solid $separator-color;
		}

		> .wc-tabs {
			grid-column: nav;
			border-left: none;
		}
	}
	// Hide element that was used for CSS hack, that's no longer needed.
	.wc-tabs-back {
		display: none;
	}

	.woocommerce_options_panel,
	.wc-metaboxes-wrapper {
		._backorders_field .wc-radios li {
			display: block;
			padding: 0 0 2px;
		}

		.wc-radios {
			display: block;
			float: left;
			margin: 0;

			li {
				display: block;
				padding: 0 0 10px;

				input {
					width: auto;
				}
			}
		}
	}

	ul.wc-tabs {
		padding: 0;
		align-self: stretch;

		li {
			min-height: var(--grid-unit-50, 40px);

			a {
				padding: 20px 24px;
				color: var(--Gray-Gray-60, $studio-gray-60);
				border-left: 3px solid transparent;

				&::before {
					margin-right: $gap-smallest;
					vertical-align: middle;
					display: inline-block;
					height: 14px;
				}
				span {
					vertical-align: middle;
				}
			}

			&.active a {
				color: var(--Alias-text-text, $alias-text);
				font-weight: 700;
				border-left: 3px solid var(--wp-admin-theme-color, $studio-wordpress-blue);
			}
		}
		// Overwrite marketplace css with higher specificity.
		li.marketplace-suggestions_options.marketplace-suggestions_tab a span {
			margin: 0;
		}
	}
}

#woocommerce-coupon-description {
	padding: $gap-smallest $gap;
	font-size: 1.7em;
	line-height: 1.42em;
	height: auto;
	width: 100%;
	outline: 0;
	margin: $gap-smaller 0;
	display: block;
	border-radius: $border-radius;

	&::-webkit-input-placeholder {
		line-height: 1.42em;
		color: #bbb;
	}

	&::-moz-placeholder {
		line-height: 1.42em;
		color: #bbb;
	}

	&:-ms-input-placeholder {
		line-height: 1.42em;
		color: #bbb;
	}

	&:-moz-placeholder {
		line-height: 1.42em;
		color: #bbb;
	}
}

@media only screen and (max-width: 1280px) {
	#woocommerce-product-data,
	#woocommerce-coupon-data {
		.options_group,
		/*
		 * General coupos data does not have options group wrapper,
		 * make it look like it has.
		 */
		#general_coupon_data {
			padding: $gap calc($gap * 4 / 3);
		}
	}
}

/**
  * Optimisation for screens 900px and smaller
  */
@media only screen and (max-width: 900px) {
	#woocommerce-product-data,
	#woocommerce-coupon-data {
		.panel-wrap {
			grid-template-columns: [nav] 10% [content] 90%;
		}

		.options_group,
		/*
		 * General coupos data does not have options group wrapper,
		 * make it look like it has.
		 */
		#general_coupon_data {
			padding: $gap-small $gap;
		}
	}

	#woocommerce-coupon-data ul.coupon_data_tabs li,
	#woocommerce-product-data ul.product_data_tabs li {
		min-height: calc(var(--grid-unit-50, 40px) / 2);

		a {
			position: relative;
			text-indent: -999px;
			padding: $gap-smaller;

			&::before {
				position: absolute;
				top: 0;
				right: 0;
				bottom: 0;
				left: 0;
				text-indent: 0;
				text-align: center;
				line-height: 40px;
				width: 100%;
				height: 40px;
			}
		}
	}
}

/**
 * Optimisation for screens 782px and smaller
 */
@media only screen and (max-width: 782px) {
	#woocommerce-product-data .checkbox {
		width: 25px;
	}
}
